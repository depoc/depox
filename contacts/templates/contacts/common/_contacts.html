{% load static %}
{% load contacts %}

<div class="
    sm:px-3
    col-span-2
    relative">

    <p class="text-4xl font-medium text-black dark:text-white mt-6 sm:mt-14 px-1">
        <kbd>contatos</kbd>
    </p>    

    <div class="flex flex-wrap items-center w-full gap-2 md:flex-nowrap sm:gap-5 mb-5 mt-1">
        <!--searchbar-->
        <form action="{% url "contacts:main" %}" method="GET" class="relative w-full sm:w-1/2 h-8 sm:h-7 mb-2 sm:mb-0 px-1 rounded-lg">
            <svg
                class="absolute top-1/2 left-3 -translate-y-1/2 w-4 h-4 text-black/50 dark:text-white/50" 
                xmlns="http://www.w3.org/2000/svg" 
                fill="none" 
                viewBox="0 0 24 24" 
                stroke-width="1.5" 
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z" />
            </svg>        
            <input
                class="
                w-full h-full pl-7 items-center p-2
                text-sm text-black/50 dark:text-white/50 
                rounded-lg 
                bg-[rgba(0,0,0,0.02)] dark:bg-tertiary
                ring-1 ring-black/10 dark:ring-white/15
                outline-none
                placeholder:text-black/30 dark:placeholder:text-white/30"
                placeholder="pesquisar por nome, apelido, celular ou cpf"
                type="text"
                name="q">
        </form>

        <!--filter buttons-->    
        <div class="
            overflow-hidden
            w-full
            items-center justify-between
            relative">

            <div class="
                justify-start
                relative
                overflow-auto
                flex">
                
                <div class="overflow-x-auto px-1 py-1 pb-1 flex gap-3 no-scrollbar">
                <a id="semana" href="?filtro=todos{% if request.GET.banco %}&banco={{ request.GET.banco }}{% endif %}"
                    class="
                    tracking-wide
                    px-3 py-[3px] sm:px-3 sm:py-[4px]
                    ring-1
                    text-[13px]
                    {% if request.GET.filtro == 'todos' %}
                        bg-blue-50 dark:bg-blue-950
                        text-blue-500 dark:text-blue-200
                        ring-blue-500 dark:ring-blue-500
                    {% else %}
                        text-black/40 dark:text-white/55
                        ring-black/10 dark:ring-white/20
                        dark:bg-primary
                    {% endif %}
                    relative  
                    rounded-full flex-shrink-0">     
                    <span class="">todos</span>
                </a>  

                <a id="todos" href="?filtro=clientes{% if request.GET.banco %}&banco={{ request.GET.banco }}{% endif %}"
                    class="
                    tracking-wide
                    px-3 py-[3px] sm:px-3 sm:py-[4px]
                    ring-1
                    text-[13px]
                    {% if request.GET.filtro == 'clientes' %}
                        bg-blue-50 dark:bg-blue-950
                        text-blue-500 dark:text-blue-200
                        ring-blue-500 dark:ring-blue-500
                    {% else %}
                        text-black/40 dark:text-background/55
                        ring-black/10 dark:ring-white/20
                        dark:bg-primary
                    {% endif %}
                    relative  
                    rounded-full flex-shrink-0">  
                    <span class="">clientes</span>
                </a> 

                <a id="hoje" href="?filtro=fornecedores{% if request.GET.banco %}&banco={{ request.GET.banco }}{% endif %}"
                    class="
                    tracking-wide
                    px-3 py-[3px] sm:px-3 sm:py-[4px]
                    ring-1
                    text-[13px]
                    {% if request.GET.filtro == 'fornecedores' %}
                        bg-blue-50 dark:bg-blue-950
                        text-blue-500 dark:text-blue-200
                        ring-blue-500 dark:ring-blue-500
                    {% else %}
                        text-black/40 dark:text-white/55
                        ring-black/10 dark:ring-white/20
                        dark:bg-primary
                    {% endif %}
                    relative  
                    rounded-full flex-shrink-0">    
                    <span>fornecedores</span>
                </a> 

                <a id="semana" href="?filtro=vendedores{% if request.GET.banco %}&banco={{ request.GET.banco }}{% endif %}"
                    class="
                    tracking-wide
                    px-3 py-[3px] sm:px-3 sm:py-[4px]
                    ring-1
                    text-[13px]
                    {% if request.GET.filtro == 'vendedores' %}
                        bg-blue-50 dark:bg-blue-950
                        text-blue-500 dark:text-blue-200
                        ring-blue-500 dark:ring-blue-500
                    {% else %}
                        text-black/40 dark:text-white/55
                        ring-black/10 dark:ring-white/20
                        dark:bg-primary
                    {% endif %}
                    relative  
                    rounded-full flex-shrink-0">     
                    <span class="">vendedores</span>
                </a>                          
                </div>    
            </div>
        </div>   
    </div>

    {% if not request.GET.q %}
    <p class="text-lg text-black/30 dark:text-white/50 mt-2 px-3">
        recentes
    </p>   
    <!--contacts-->
    <div class="
        mt-1 px-1
        grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4
        gap-3">

        {% for contact in recent_contacts %}
        <div
            class="
            p-2
            outline-none
            ring-1
            ring-black/5 dark:ring-white/10 dark:hover:ring-white/20
            shadow-sm hover:shadow-lg 
            relative
            rounded-xl
            bg-white/50
            dark:bg-secondary/50 
            min-h-[150px]
            w-full
            flex-shrink-0">

            <div class="flex items-center justify-between h-[30px] w-full rounded-xl mb-[5px]">
                <button class="bg-black/5 dark:bg-tertiary w-fit px-4 py-1 rounded-full">
                    <p
                        class="
                        text-nowrap text-xs font-medium tracking-wide
                        text-black/40 dark:text-white/60
                        truncate">
                        {% if contact.celular %}
                        {{ contact.celular | format_phone_number }}
                        {% else %}
                        cadastrar celular
                        {% endif %}
                    </p>
                </button>  
                <div class="w-fit h-fit">
                    <p
                        class="
                        text-nowrap text-xs font-medium
                        text-black/40 dark:text-white/60
                        truncate">
                        <kbd>{{ contact.id }}</kbd>
                    </p>
                </div>                             
            </div>        

            <a  href="{% url "contacts:edit_contact" contact.id %}"
                class="flex flex-col justify-between items-start bg-black/5 dark:bg-tertiary w-full h-[130px] rounded-xl">  
                <div class="px-3 py-2">
                    <div
                        class="
                        text-start text-sm mb-9
                        text-black/30 dark:text-white/30
                        truncate">
                        <svg class="size-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                            <path fill-rule="evenodd" d="M4.5 7.5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-9a3 3 0 0 1-3-3v-9Z" clip-rule="evenodd" />
                        </svg>                                               
                    </div> 

                    <p
                        class="
                        w-full relative
                        text-start text-lg font-medium
                        text-black/55 dark:text-white
                        truncate">
                        {{ contact.apelido }}                                
                    </p>      

                    
                    <div
                        class="
                        w-full bottom-1 relative
                        text-xs text-start
                        text-black/40 dark:text-white/40
                        truncate">
                        
                        <span class="">
                            {{ contact.nome }}
                        </span>          
                        <span class="line-clamp-1">
                            {{ contact.cpf_cnpj | format_cpf_cnpj }}
                        </span>                                                   
                    </div>                       
                </div>                    
            </a>
        </div>  
        {% endfor %}
      
    </div> 
    {% endif %}

    <p class="text-lg text-black/30 dark:text-white/50 mt-6 px-3">
        {% if request.GET.q %} resultados para: "{{ request.GET.q }}"
        {% else %} todos {% endif %}
    </p>
    <!--contacts-->
    <div class="
        mt-1 px-1
        grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4
        gap-3">

        {% for contact in contacts %}
        <div
            class="
            p-2
            outline-none
            ring-1
            ring-black/5 dark:ring-white/10 dark:hover:ring-white/20
            shadow-sm hover:shadow-lg 
            relative
            rounded-xl
            bg-white/50
            dark:bg-secondary/50 
            min-h-[150px]
            w-full
            flex-shrink-0">

            <div class="flex items-center justify-between h-[30px] w-full rounded-xl mb-[5px]">
                <button class="bg-black/5 dark:bg-tertiary w-fit px-4 py-1 rounded-full">
                    <p
                        class="
                        text-nowrap text-xs font-medium tracking-wide
                        text-black/40 dark:text-white/60
                        truncate">
                        {% if contact.celular %}
                        {{ contact.celular | format_phone_number }}
                        {% else %}
                        cadastrar celular
                        {% endif %}
                    </p>
                </button>  
                <div class="w-fit h-fit">
                    <p
                        class="
                        text-nowrap text-xs font-medium
                        text-black/40 dark:text-white/60
                        truncate">
                        <kbd>{{ contact.id }}</kbd>
                    </p>
                </div>                             
            </div>        

            <a  href="{% url "contacts:edit_contact" contact.id %}"
                class="contact-info-button flex flex-col justify-between items-start bg-black/5 dark:bg-tertiary w-full h-[130px] rounded-xl">  
                <div class="px-3 py-2">
                    <div
                        class="
                        text-start text-sm mb-9
                        text-black/30 dark:text-white/30
                        truncate">
                        <svg class="size-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                            <path fill-rule="evenodd" d="M4.5 7.5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-9a3 3 0 0 1-3-3v-9Z" clip-rule="evenodd" />
                        </svg>                                               
                    </div> 

                    <p
                        class="
                        w-full relative
                        text-start text-lg font-medium
                        text-black/55 dark:text-white
                        truncate">
                        {{ contact.apelido }}                                
                    </p>      

                    
                    <div
                        class="
                        w-full bottom-1 relative
                        text-xs text-start
                        text-black/40 dark:text-white/40
                        truncate">
                        
                        <span class="">
                            {{ contact.nome }}
                        </span>          
                        <span class="line-clamp-1">
                            {{ contact.cpf_cnpj | format_cpf_cnpj }}
                        </span>                                                   
                    </div>                       
                </div>                    
            </a>
        </form>
        </div>  
        {% endfor %}
      
    </div> 
       
</div>